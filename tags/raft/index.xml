<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>raft on Challen</title>
    <link>/tags/raft/</link>
    <description>Recent content in raft on Challen</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <copyright>ChallenAi</copyright>
    <lastBuildDate>Sat, 15 May 2021 07:48:16 +0800</lastBuildDate><atom:link href="/tags/raft/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>åˆ†å¸ƒå¼é”®å€¼å­˜å‚¨ç³»ç»Ÿçš„è®¾è®¡ä¸å®ç°</title>
      <link>/posts/tech/kvstore/</link>
      <pubDate>Sat, 15 May 2021 07:48:16 +0800</pubDate>
      
      <guid>/posts/tech/kvstore/</guid>
      <description>åˆ†å¸ƒå¼é”®å€¼å­˜å‚¨ç³»ç»Ÿçš„è®¾è®¡ä¸å®ç° Author: ChallenAi
æ‘˜ è¦ ç•¥
å…³é”®è¯ï¼šé”®å€¼æ•°æ®åº“ï¼›å¤§æ•°æ®ï¼›æ•°æ®åˆ†ç‰‡ï¼›Raft ç®—æ³•
Distributed KV Database Design and Implementation ABSTRACT Section omitted
Key wordsï¼šDistributed Database; Scalable; Data Sharding; Raft Algorithm
ç›® å½• 1 ç»ª è®º
2 å…³é”®æŠ€æœ¯
2.1 æ•°æ®åˆ†ç‰‡
2.2 CAP ç†è®º
2.3 å…±è¯†ç®—æ³•
2.4 LSM æ ‘
3 ç³»ç»Ÿè®¾è®¡å’Œå®ç°
3.1 è®¾è®¡éœ€æ±‚
3.2 ç³»ç»Ÿ API
3.3 æ€»ä½“æ¶æ„
3.4 æ•°æ®åˆ†ç‰‡
3.5 çŠ¶æ€åŒæ­¥å’ŒæŒä¹…åŒ–è¿‡ç¨‹
3.6 å®¢æˆ·ç«¯
3.7 è°ƒç”¨è¿‡ç¨‹
4 æ€»ç»“
4.1 å­¦åˆ°çš„ç»éªŒ
4.2 å…¶ä»–å·¥ä½œå’Œå¯ä»¥ä¼˜åŒ–çš„åœ°æ–¹
å‚è€ƒæ–‡çŒ®
è‡´ è°¢
1 ç»ª è®º ç•¥</description>
      <content>&lt;h1 id=&#34;åˆ†å¸ƒå¼é”®å€¼å­˜å‚¨ç³»ç»Ÿçš„è®¾è®¡ä¸å®ç°&#34;&gt;åˆ†å¸ƒå¼é”®å€¼å­˜å‚¨ç³»ç»Ÿçš„è®¾è®¡ä¸å®ç°&lt;/h1&gt;
&lt;p&gt;Author: ChallenAi&lt;/p&gt;
&lt;h2 id=&#34;æ‘˜-è¦&#34;&gt;æ‘˜ è¦&lt;/h2&gt;
&lt;p&gt;ç•¥&lt;/p&gt;
&lt;p&gt;å…³é”®è¯ï¼šé”®å€¼æ•°æ®åº“ï¼›å¤§æ•°æ®ï¼›æ•°æ®åˆ†ç‰‡ï¼›Raft ç®—æ³•&lt;/p&gt;
&lt;h1 id=&#34;distributed-kv-database-design-and-implementation&#34;&gt;Distributed KV Database Design and Implementation&lt;/h1&gt;
&lt;h2 id=&#34;abstract&#34;&gt;ABSTRACT&lt;/h2&gt;
&lt;p&gt;Section omitted&lt;/p&gt;
&lt;p&gt;Key wordsï¼šDistributed Database; Scalable; Data Sharding; Raft Algorithm&lt;/p&gt;
&lt;h2 id=&#34;ç›®-å½•&#34;&gt;ç›® å½•&lt;/h2&gt;
&lt;p&gt;1 ç»ª è®º&lt;br&gt;
2 å…³é”®æŠ€æœ¯&lt;br&gt;
2.1 æ•°æ®åˆ†ç‰‡&lt;br&gt;
2.2 CAP ç†è®º&lt;br&gt;
2.3 å…±è¯†ç®—æ³•&lt;br&gt;
2.4 LSM æ ‘&lt;br&gt;
3 ç³»ç»Ÿè®¾è®¡å’Œå®ç°&lt;br&gt;
3.1 è®¾è®¡éœ€æ±‚&lt;br&gt;
3.2 ç³»ç»Ÿ API&lt;br&gt;
3.3 æ€»ä½“æ¶æ„&lt;br&gt;
3.4 æ•°æ®åˆ†ç‰‡&lt;br&gt;
3.5 çŠ¶æ€åŒæ­¥å’ŒæŒä¹…åŒ–è¿‡ç¨‹&lt;br&gt;
3.6 å®¢æˆ·ç«¯&lt;br&gt;
3.7 è°ƒç”¨è¿‡ç¨‹&lt;br&gt;
4 æ€»ç»“&lt;br&gt;
4.1 å­¦åˆ°çš„ç»éªŒ&lt;br&gt;
4.2 å…¶ä»–å·¥ä½œå’Œå¯ä»¥ä¼˜åŒ–çš„åœ°æ–¹&lt;br&gt;
å‚è€ƒæ–‡çŒ®&lt;br&gt;
è‡´ è°¢&lt;/p&gt;
&lt;h3 id=&#34;1-ç»ª-è®º&#34;&gt;1 ç»ª è®º&lt;/h3&gt;
&lt;p&gt;ç•¥&lt;/p&gt;
&lt;h3 id=&#34;2-å…³é”®æŠ€æœ¯&#34;&gt;2 å…³é”®æŠ€æœ¯&lt;/h3&gt;
&lt;h4 id=&#34;21-æ•°æ®åˆ†ç‰‡&#34;&gt;2.1 æ•°æ®åˆ†ç‰‡&lt;/h4&gt;
&lt;p&gt;é”®å€¼æ•°æ®åº“æ•°æ®åˆ†ç‰‡çš„æ–¹æ³•é€šå¸¸æœ‰æ ¹æ®é”®çš„èŒƒå›´åˆ†ç‰‡å’Œæ ¹æ®é”®çš„æ•£åˆ—åˆ†ç‰‡ï¼Œæ ¹æ®é”®çš„èŒƒå›´åˆ†ç‰‡é€šå¸¸ç»™æ¯ä¸ªåˆ†ç‰‡æŒ‡å®šä¸€å—è¿ç»­çš„é”®èŒƒå›´ï¼Œç„¶åå°†ç‰¹å®šé”®ä¿å­˜åˆ°æŒ‡å®šåˆ†ç‰‡ã€‚æ ¹æ®é”®çš„æ•£åˆ—åˆ†ç‰‡åˆ™æœ‰åŠ©äºæ•°æ®çš„å¹³è¡¡åˆ†é…ï¼Œé¿å…å‡ºç°çƒ­ç‚¹ï¼Œä½†æ˜¯ä¹Ÿä¸§å¤±äº†é«˜æ•ˆèŒƒå›´æŸ¥è¯¢çš„èƒ½åŠ›ã€‚æœ¬æ–‡æè¿°çš„ç³»ç»Ÿä½¿ç”¨äº†åè€…(æ®æ•£åˆ—åˆ†ç‰‡)ï¼Œä¸‹æ–‡ä¸­ä¸€ä¸ªåˆ†ç‰‡ç›´æ¥ç§°ä¸º shardã€‚&lt;/p&gt;
&lt;h4 id=&#34;22-cap-ç†è®º&#34;&gt;2.2 CAP ç†è®º&lt;/h4&gt;
&lt;p&gt;å¯¹äºå¤šå‰¯æœ¬çš„æ•°æ®åº“æ¥è¯´ï¼Œå¦‚æœéœ€è¦å®ç°çº¿æ€§ä¸€è‡´æ€§ï¼Œé‚£ä¹ˆå‡å¦‚å…¶ä¸­ä¸€éƒ¨åˆ†å‰¯æœ¬èŠ‚ç‚¹å‡ºç°ç½‘ç»œä¸­æ–­ï¼Œå‰¯æœ¬èŠ‚ç‚¹å®•æœºä¹‹ç±»ï¼Œé‚£ä¹ˆè¿™äº›å‰¯æœ¬èŠ‚ç‚¹å°±ä¸èƒ½å¤„ç†è¯·æ±‚ï¼Œéœ€è¦ç­‰åˆ°ä»–ä»¬æ¢å¤æ‰èƒ½å“åº”ï¼Œè¿™æ—¶å€™å¯ç”¨æ€§å°±ä¼šä¸‹é™ã€‚å¯¹å¯ç”¨æ€§è¾ƒé«˜çš„åœºæ™¯ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šé™ä½ä¸€è‡´æ€§è¦æ±‚ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œä¸€è‡´æ€§ï¼Œå¯ç”¨æ€§å’Œåˆ†åŒºå®¹é”™æ€§éš¾ä»¥åŒæ—¶æ»¡è¶³ï¼Œæ‰€ä»¥éœ€è¦æˆ‘ä»¬åšå‡ºæƒè¡¡ã€‚&lt;/p&gt;
&lt;h4 id=&#34;23-å…±è¯†ç®—æ³•&#34;&gt;2.3 å…±è¯†ç®—æ³•&lt;/h4&gt;
&lt;p&gt;Paxos èƒ½å¤Ÿç¡®ä¿å®‰å…¨æ€§å’Œæ´»æ€§ï¼Œå¹¶ä¸”æ”¯æŒé›†ç¾¤æˆå‘˜çš„å˜æ›´ã€‚å®ƒçš„æ­£ç¡®æ€§å·²è¢«è¯æ˜ï¼Œå¹¶ä¸”åœ¨æ­£å¸¸æƒ…å†µä¸‹æ˜¯é«˜æ•ˆçš„ã€‚åº”ç”¨å®ç°æ–¹é¢ä¸»è¦æœ‰ google çš„ chubbyï¼Œå¼€æºçš„ zookeeperï¼Œä½†æ˜¯ç›¸å¯¹åŸè®ºæ–‡åšå‡ºäº†å¾ˆå¤šä¿®æ”¹ã€‚ä¸å¹¸çš„æ˜¯ï¼ŒPaxos æœ‰ä¸¤ä¸ªæ˜¾è‘—çš„ç¼ºç‚¹ã€‚ ç¬¬ä¸€ä¸ªç¼ºç‚¹æ˜¯ Paxos éå¸¸éš¾ä»¥ç†è§£ã€‚Paxos çš„ç¬¬äºŒä¸ªé—®é¢˜æ˜¯å®ƒä¸èƒ½ä¸ºæ„å»ºå®é™…çš„å®ç°æä¾›è‰¯å¥½çš„åŸºç¡€ã€‚äºæ˜¯ Raft ç®—æ³•è¢«æå‡ºç”¨äºç®€åŒ– Paxos ç®—æ³•ã€‚&lt;/p&gt;
&lt;p&gt;æ ¹æ® Raft çš„è®ºæ–‡ï¼ŒRaft å°†é—®é¢˜åˆ†è§£æˆå‡ ä¸ªç›¸å¯¹ç‹¬ç«‹çš„ï¼Œå¯è¢«è§£å†³çš„ã€å¯è§£é‡Šçš„å’Œå¯ç†è§£çš„å­é—®é¢˜ã€‚Raft ç®—æ³•è¢«æˆ‘ä»¬åˆ†æˆ leader é€‰ä¸¾ï¼Œæ—¥å¿—å¤åˆ¶ï¼Œå®‰å…¨æ€§å’Œæˆå‘˜å˜æ›´å‡ ä¸ªéƒ¨åˆ†ï¼Œé€šè¿‡ä¸åŒå‡ éƒ¨åˆ†çš„ç»“åˆï¼Œç®€åŒ–äº†ç®—æ³•æ•´ä½“çš„å¤æ‚æ€§ã€‚Raft ç®—æ³•çš„åŸºæœ¬æ€æƒ³æ˜¯ï¼ŒRaft å°†å®¢æˆ·ç«¯è¯·æ±‚ç»„ç»‡æˆä¸€ä¸ªåºåˆ—ï¼Œç§°ä¸ºæ—¥å¿—ï¼Œå¹¶ç¡®ä¿æ‰€æœ‰å¤åˆ¶æœåŠ¡å™¨çœ‹åˆ°ç›¸åŒçš„æ—¥å¿—ã€‚æ¯ä¸ªå‰¯æœ¬æŒ‰æ—¥å¿—é¡ºåºæ‰§è¡Œå®¢æˆ·ç«¯è¯·æ±‚ï¼Œå¹¶å°†å…¶åº”ç”¨äºæœåŠ¡çŠ¶æ€çš„æœ¬åœ°å‰¯æœ¬ã€‚ç”±äºæ‰€æœ‰å®æ—¶å‰¯æœ¬éƒ½çœ‹åˆ°ç›¸åŒçš„æ—¥å¿—å†…å®¹ï¼Œå› æ­¤å®ƒä»¬éƒ½ä»¥ç›¸åŒçš„é¡ºåºæ‰§è¡Œç›¸åŒçš„è¯·æ±‚ï¼Œå› æ­¤ç»§ç»­å…·æœ‰ç›¸åŒçš„æœåŠ¡çŠ¶æ€ã€‚å¦‚æœæœåŠ¡å™¨å¤±è´¥ä½†åæ¥æ¢å¤ï¼ŒRaft ä¼šè´Ÿè´£æ›´æ–°å…¶æ—¥å¿—ã€‚åªè¦è‡³å°‘æœ‰å¤§å¤šæ•°æœåŠ¡å™¨è¿˜æ´»ç€ï¼Œå¹¶ä¸”å¯ä»¥ç›¸äº’äº¤è°ˆï¼ŒRaft å°±ä¼šç»§ç»­è¿è¡Œã€‚å¦‚æœæ²¡æœ‰è¿™æ ·çš„å¤šæ•°ï¼ŒRaft å°†ä¸ä¼šå–å¾—è¿›å±•ï¼Œä½†ä¸€æ—¦å¤šæ•°äººèƒ½å¤Ÿå†æ¬¡æ²Ÿé€šï¼ŒRaft ä¼šå°½å¿«æ¢å¤åˆ°å®ƒä¸­æ–­çš„åœ°æ–¹ã€‚å¤æ‚æ€§çš„é™ä½ä½¿å¾—ç®—æ³•çš„å·¥ç¨‹å®ç°ä¸Šæ›´æ˜“äºç»´æŠ¤ã€‚åŒæ—¶ï¼ŒRaft å’Œ Paxos æ•ˆç‡ç›¸ã€‚å› æ­¤ç¬”è€…é€‰ç”¨äº† Raft ç®—æ³•ã€‚&lt;/p&gt;
&lt;h4 id=&#34;24-lsm-æ ‘&#34;&gt;2.4 LSM æ ‘&lt;/h4&gt;
&lt;p&gt;LSM çš„æ€æƒ³æ˜¯å¯¹äºæ–°åˆ°æ¥çš„æ•°æ®ç›´æ¥ä¿æŒåœ¨å†…å­˜ä¸­ï¼Œç»´æŒä¸€ä¸ªæœ‰åºçš„ç»“æ„ï¼Œäº‹å®ä¸Šå¼€æºå®ç° leveldb ä½¿ç”¨è·³è¡¨ç»´æŒæœ‰åºï¼Œå†…å­˜ä¸­çš„ç»“æ„è¢«å«åš memtableï¼Œå½“ memtable å¤§å°è¿‡å¤§åˆ™ä¼šä¸€å±‚ä¸€å±‚åºåˆ—åŒ–æˆ sstable(Sorted Strings Table)åˆ°ç£ç›˜ä¸­ã€‚ä»–ä»¬æ°¸è¿œä¸ä¼šæ›´æ–°ï¼Œåªä¼šä¸æ–­å‘ä¸‹åˆå¹¶ï¼Œè¿™ä¸ªè¿‡ç¨‹å«åš compationï¼Œä»è€Œæé«˜å†™å…¥é€Ÿåº¦ï¼Œå› ä¸ºä¸å­˜åœ¨æ’å…¥æ“ä½œï¼Œæ‰€ä»¥ä¸éœ€è¦ B æ ‘é‚£æ ·çš„é¡µåˆ†è£‚ã€‚ç›¸å¯¹çš„ä¹Ÿå¼•å…¥äº†å†™æ”¾å¤§ï¼ŒæŸ¥è¯¢é€Ÿåº¦ç›¸å¯¹è¾ƒæ…¢ç­‰é—®é¢˜ï¼Œä½œä¸ºæƒè¡¡ï¼Œä¸ºäº†è§£å†³æµ·é‡æ•°æ®å­˜å‚¨çš„é—®é¢˜ï¼Œåœ¨æ”¾å¼ƒ B æ ‘é«˜æ•ˆæŸ¥è¯¢çš„åŒæ—¶ä¹Ÿå¯ä»¥å¼•å…¥å¸ƒéš†è¿‡æ»¤å™¨æ¥æå‡éƒ¨åˆ†æ•´ä½“æ€§èƒ½ï¼Œä¸å­˜åœ¨çš„æ•°æ®ä¼šè¢«å¸ƒéš†è¿‡æ»¤å™¨è¿‡æ»¤ï¼Œåªæœ‰æå°‘é‡è¯¯åˆ¤çš„æ•°æ®åˆ™ä¼šè¢«å‡»ç©¿åˆ°æ•°æ®åº“ä¸­ï¼Œåœ¨ä¸åŒå±‚æ¬¡çš„ sst ä¸­æŸ¥æ‰¾ã€‚&lt;/p&gt;
&lt;h3 id=&#34;3-ç³»ç»Ÿè®¾è®¡å’Œå®ç°&#34;&gt;3 ç³»ç»Ÿè®¾è®¡å’Œå®ç°&lt;/h3&gt;
&lt;h4 id=&#34;31-è®¾è®¡éœ€æ±‚&#34;&gt;3.1 è®¾è®¡éœ€æ±‚&lt;/h4&gt;
&lt;p&gt;è®¾è®¡ä¸€ä¸ªé«˜æ€§èƒ½çš„åˆ†å¸ƒå¼ kv æ•°æ®åº“ï¼Œæ”¯æŒ get/put/delete æ“ä½œã€‚æ•°æ®åˆ†å¸ƒåœ¨ä¸åŒçš„æœåŠ¡å™¨ä¸Šï¼Œå½“æ•°æ®é‡å˜å¤§æ—¶ï¼Œå¯ä»¥é€šè¿‡å¢åŠ æœåŠ¡å™¨å¢åŠ æ•°æ®åº“çš„å­˜å‚¨å®¹é‡ï¼ŒåŒæ—¶åˆ†æ•£è¯·æ±‚åˆ°ä¸åŒçš„æœåŠ¡å™¨ï¼Œä»¥ä¾¿äºæ‹†åˆ†è¯·æ±‚è´Ÿè½½æé«˜æ€§èƒ½ã€‚&lt;/p&gt;
&lt;h4 id=&#34;32-ç³»ç»Ÿ-api&#34;&gt;3.2 ç³»ç»Ÿ API&lt;/h4&gt;
&lt;p&gt;é€šè¿‡ set(key, val)è®¾ç½®ä¸€ä¸ªé”®çš„å€¼ã€‚é€šè¿‡ get(key)è·å–ä¸€ä¸ªé”®çš„å€¼ã€‚é€šè¿‡ delete(key)åˆ é™¤ä¸€ä¸ªé”®ã€‚
set/get/delete æä¾›äº†å¼ºä¸€è‡´æ€§ï¼Œæ¯æ¬¡è°ƒç”¨å¯ä»¥è§‚å¯Ÿåˆ°ä¹‹å‰æ‰€æœ‰çš„è°ƒç”¨ç»“æœã€‚è®¡ä¸€ä¸ªé«˜æ€§èƒ½çš„åˆ†å¸ƒã€‚&lt;/p&gt;
&lt;h4 id=&#34;33-æ€»ä½“æ¶æ„&#34;&gt;3.3 æ€»ä½“æ¶æ„&lt;/h4&gt;
&lt;p&gt;æ•°æ®åº“ä¸»è¦ç”±ä¸‰éƒ¨åˆ†æ„æˆï¼Œåˆ†åˆ«æ˜¯ kv æœåŠ¡å™¨ï¼Œmeta æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ã€‚ä¸‰è€…ä¹‹é—´å»ºç«‹ TCP è¿æ¥ï¼Œé€šè¿‡ RPC è¿›è¡Œé€šä¿¡ã€‚åœ¨æˆ‘ä»¬çš„æµ‹è¯•ç³»ç»Ÿä¸­ï¼Œè€ƒè™‘åˆ°å®éªŒç¯å¢ƒç¡¬ä»¶å’Œæœºå™¨èµ„æºçš„é™åˆ¶ï¼Œå…¼ä¸” RPC å¹¶ä¸èƒ½ä½“ç°å­˜å‚¨ç³»ç»Ÿçš„æ ¸å¿ƒè®¾è®¡æ€æƒ³ï¼Œåˆ™ç®€å•ä½¿ç”¨ golang è¯­è¨€çš„åç¨‹(goroutine)æ¥æ¨¡æ‹Ÿé€šä¿¡ï¼Œé€šè¿‡ç›´æ¥ä¼ é€ golang é‡Œçš„ç»“æ„ä½“å®ä¾‹æ¥ä¼ é€æ¶ˆæ¯ï¼Œä¹Ÿé¿å…å¤„ç†æ¶ˆæ¯ä¸¢å¤±ï¼Œä¹±åºï¼Œåº”ç”¨æ¶ˆæ¯è§£åŒ…ç­‰é—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;å®¢æˆ·ç«¯ã€meta æœåŠ¡å™¨å’Œ kv æœåŠ¡å™¨é—´å»ºç«‹è¿æ¥å¹¶ä¸ä¼šç»™ meta æœåŠ¡å™¨å¸¦æ¥å¤§é‡è´Ÿè½½å‹åŠ›ï¼ŒTCP è¿æ¥æ˜¯ä¸€ç»„é•¿è¿æ¥ï¼ŒåŒæ—¶ç”±äº meta æœåŠ¡å™¨æœ¬èº«å¹¶ä¸æ¥å—è¯·æ±‚ï¼Œåªè´Ÿè´£è°ƒåº¦åˆ†ç‰‡çš„å…ƒä¿¡æ¯ï¼ŒåŒæ—¶ä»…ä»…é€šä¿¡é…ç½®ä¿¡æ¯è€Œä¸æ˜¯å®é™…çš„è¯»å†™è¯·æ±‚æˆ– Shard æ•°æ®ï¼Œæ‰€ä»¥ meta æœåŠ¡å™¨çš„è´Ÿè½½ä»…ä»…æ¥è‡ªäºå°‘é‡çš„ kv æœåŠ¡å™¨ä¼ é€çš„å°‘é‡æ•°æ®ã€‚&lt;/p&gt;
&lt;p&gt;æ•´ä½“æ¶æ„å¦‚å›¾ 3.1 æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;../../vendor/images/kvstore.png&#34; alt=&#34;æ€»ä½“æ¶æ„&#34;&gt;
å›¾ 3.1 æ•°æ®åº“çš„æ€»ä½“æ¶æ„&lt;/p&gt;
&lt;p&gt;ç¬¬ä¸€éƒ¨åˆ†æ˜¯å®é™…å­˜å‚¨æ•°æ®çš„ kv æœåŠ¡å™¨ï¼Œæ•°æ®æ˜¯è¢«ä»¥åˆ†ç‰‡(shard)çš„æ–¹å¼ä¸€æ®µä¸€æ®µçš„å­˜å‚¨åœ¨ kv æœåŠ¡å™¨ä¸Šçš„ï¼Œå€¼å¾—ä¸€æçš„æ˜¯è¿™é‡Œçš„ shard å› ä¸ºé‡‡ç”¨ hash åˆ†ç‰‡çš„æ–¹å¼ï¼Œæ‰€ä»¥æ•°æ®æ˜¯ä¸è¿ç»­çš„ï¼Œæ‰€ä»¥ api é‡Œæ²¡æœ‰æä¾› scan æ¥å£ï¼Œå›¿äºç¬”è€…æ°´å¹³ï¼Œåœ¨æ•£åˆ—åˆ†ç‰‡çš„æ–¹å¼ä¸‹ï¼Œæ²¡æœ‰æƒ³åˆ°é«˜æ•ˆçš„èŒƒå›´æŸ¥è¯¢çš„å®ç°æ–¹å¼ï¼ŒæŒ‰ç…§é”®èŒƒå›´åˆ†ç‰‡çš„æ–¹å¼å› ä¸ºå­˜å‚¨å¤©ç„¶æœ‰åºï¼Œåˆ™å¾ˆå®¹æ˜“å®ç° scan æŸ¥è¯¢ã€‚&lt;/p&gt;
&lt;p&gt;shard æœ¬èº«æ˜¯ç›´æ¥å­˜å‚¨åœ¨ pebble é‡Œé¢çš„ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå®ƒå½“åšä¼˜åŒ–ç‰ˆçš„ leveldbï¼Œä¸»è¦ä¼˜åŒ–äº†å¤šçº¿ç¨‹ compactionï¼Œå¤šçº¿ç¨‹ flush ç­‰ã€‚åŒæ—¶å¤šä¸ª shard å­˜å‚¨åœ¨åŒä¸€ä¸ª pebble å¼•æ“å®ä¾‹ä¸­ä»¥æé«˜æ€§èƒ½ã€‚&lt;/p&gt;
&lt;p&gt;ç¬¬äºŒéƒ¨åˆ†æ˜¯ meta æœåŠ¡å™¨ï¼Œmeta æœåŠ¡å™¨æœ¬èº«ä¸ºäº†å®¹é”™ï¼Œä½¿ç”¨ Raft ç®—æ³•åˆ›å»ºäº† 3 ä¸ªå‰¯æœ¬ï¼Œè¿™æ ·åªè¦å…¶ä¸­ä¸¤ä¸ªä¿æŒå·¥ä½œï¼Œç³»ç»Ÿä¾ç„¶èƒ½è¿è¡Œã€‚meta æœåŠ¡å™¨ä¸»è¦å­˜å‚¨ shard æ‰€å±çš„ Raft Group å’Œ Raft Group ä¸ kv æœåŠ¡å™¨ä¹‹é—´çš„å…³ç³»ã€‚æˆ‘ä»¬å®ç°äº†ä» shard çš„ç®€å•è°ƒåº¦ï¼ŒæœŸæœ›æ•°æ®å°½å¯èƒ½çš„å¹³å‡åˆ†å¸ƒåœ¨ä¸åŒçš„èŠ‚ç‚¹ä¸Šä»¥é¿å…æ•°æ®å€¾æ–œã€‚å½“ shard æ•°é‡æˆ–è€… Raft Group å‘ç”Ÿå˜åŒ–çš„æ—¶å€™ã€‚shard ä¼šè‡ªåŠ¨é‡æ–°å¹³è¡¡åœ¨ä¸åŒçš„ Raft Group ä¸­ä»¥é‡æ–°å¹³è¡¡æ•°æ®ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äºæ¯ä¸ª shard, Raft Group å’Œ kv æœåŠ¡å™¨ä¹‹é—´çš„å…³ç³»ï¼Œæˆ‘ä»¬å°è£…ä¸ºä¸€ä¸ªé…ç½®(ä¸€ä¸ª Config ç»“æ„ä½“)ï¼Œå½“ Config å‘ç”Ÿå˜åŠ¨æ—¶ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„é…ç½®å¹¶å°†å®ƒå¤åˆ¶åˆ° meta æœåŠ¡å™¨çš„å…¶ä»–èŠ‚ç‚¹ä¸­æ¥ã€‚&lt;/p&gt;
&lt;p&gt;meta æœåŠ¡å™¨ä¹Ÿæš´éœ²äº† Query(configId)æ¥å£ï¼Œç”¨äºæŸ¥è¯¢ç‰¹å®š config ä¸‹çš„é…ç½®ä¸­çš„ shard æ˜ å°„ã€‚åŒæ—¶ä¹Ÿæ–¹ä¾¿å®¢æˆ·ç«¯ç¼“å­˜ shard å’Œå®é™…çš„ kv æœåŠ¡å™¨ä¹‹é—´çš„æ˜ å°„ï¼Œè¿™æ ·å®¢æˆ·ç«¯ä¸éœ€è¦åœ¨æ¯æ¬¡ get ç­‰è¯·æ±‚æ—¶éƒ½è®¿é—® meta æœåŠ¡å™¨è·å– shard ä½ç½®ä¿¡æ¯ï¼Œæé«˜äº†ç³»ç»Ÿæ•´ä½“çš„è¯·æ±‚é€Ÿåº¦ã€‚&lt;/p&gt;
&lt;p&gt;ç¬¬ä¸‰éƒ¨åˆ†æ˜¯å®¢æˆ·ç«¯ï¼Œç”¨äºæš´éœ²å®é™…çš„ get/put/delete æ¥å£ã€‚ä»å®è§‚ä¸Šçœ‹ï¼Œæ¯ä¸ªæŸ¥è¯¢åº”è¯¥é¦–å…ˆæ‰¾åˆ°åˆ†ç‰‡æ‰€å¤„çš„ kv æœåŠ¡å™¨ç»„ï¼Œç„¶åé€šè¿‡æœåŠ¡å™¨ç»„çš„ Leader é€šè¿‡ AppendEntry RPC æ¥å¹¿æ’­æ•°æ®ï¼Œå¦‚æœæ•°æ®å¹¿æ’­æˆåŠŸï¼ŒLeader å¯ä»¥å†™å…¥æ•°æ®åˆ°æˆ‘ä»¬çš„ pepple å¼•æ“ã€‚åŒæ—¶è¯·æ±‚ä¹Ÿå¯ä»¥è¿”å›ã€‚å¦‚æœå¹¿æ’­å¤±è´¥æˆ–å¤§éƒ¨åˆ†èŠ‚ç‚¹æ²¡æœ‰è¿”å›æ­£ç¡®çš„å“åº”ï¼Œåˆ™ä¸ä¼šå†™å…¥æˆ–è¯»å–æˆåŠŸæ•°æ®ï¼Œè¯»å–åˆ°çš„æ•°æ®å¾ˆå¯èƒ½æ˜¯é™ˆæ—§çš„ï¼Œå¯¹äºè¿™ç§æƒ…å†µï¼Œè¿”å›é”™è¯¯çš„å“åº”ç»™ç”¨æˆ·ã€‚&lt;/p&gt;
&lt;p&gt;kv æœåŠ¡å™¨çš„ç»“æ„ä½“ä¼ªä»£ç å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;KVServer&lt;/span&gt; {
  &lt;span style=&#34;color:#a6e22e&#34;&gt;persister&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;Persister&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;// æŒä¹…åŒ–ç»“æ„ä½“
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;Raft&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;// Raft èŠ‚ç‚¹ç»“æ„ä½“
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  &lt;span style=&#34;color:#a6e22e&#34;&gt;make_end&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;string&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;ClientEnd&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;// å’Œå…¶ä»– kv æœåŠ¡å™¨å»ºç«‹è¿æ¥çš„å‡½æ•°ï¼Œç”¨äºè·å–å…¶ä»– kv æœåŠ¡å™¨çš„ shard
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  &lt;span style=&#34;color:#a6e22e&#34;&gt;gid&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;// Raft Group Id
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  &lt;span style=&#34;color:#a6e22e&#34;&gt;mck&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;metaServer&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Client&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;// meta æœåŠ¡å™¨çš„å®¢æˆ·ç«¯ï¼Œç”¨äºè½®è®­è·å–æ–°é…ç½®
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  &lt;span style=&#34;color:#a6e22e&#34;&gt;config&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;shardmaster&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Config&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;// æœ¬ kv æœåŠ¡å™¨çš„æœ€æ–°é…ç½®ï¼Œä¼šå†™æ˜æœ€æ–°åº”è¯¥æ‹¥æœ‰çš„ shard
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  &lt;span style=&#34;color:#a6e22e&#34;&gt;ownShards&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;IntSet&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;// å½“å‰é…ç½®çš„æ‹¥æœ‰çš„ shard
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  &lt;span style=&#34;color:#a6e22e&#34;&gt;migratingShards&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;HashMap&lt;/span&gt;&amp;lt;&lt;span style=&#34;color:#a6e22e&#34;&gt;configId&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;kvpairs&lt;/span&gt;&amp;gt; &lt;span style=&#34;color:#75715e&#34;&gt;// é…ç½®å·åˆ°éœ€è¦è¿ç§»çš„æ•°æ®çš„æ˜ å°„
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  &lt;span style=&#34;color:#a6e22e&#34;&gt;waitingShards&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;HashMap&lt;/span&gt;&amp;lt;&lt;span style=&#34;color:#a6e22e&#34;&gt;shardId&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;gid&lt;/span&gt;&amp;gt; &lt;span style=&#34;color:#75715e&#34;&gt;// shard å·åˆ°éœ€è¦è¯·æ±‚çš„ shard çš„ç»„å·
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  &lt;span style=&#34;color:#a6e22e&#34;&gt;cleaningShards&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;HashMap&lt;/span&gt;&amp;lt;&lt;span style=&#34;color:#a6e22e&#34;&gt;configId&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;shardId&lt;/span&gt;&amp;gt; &lt;span style=&#34;color:#75715e&#34;&gt;// éœ€è¦æ¸…é™¤çš„ shard å·
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  &lt;span style=&#34;color:#a6e22e&#34;&gt;historyConfigs&lt;/span&gt; []&lt;span style=&#34;color:#a6e22e&#34;&gt;shardmaster&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Config&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;// å†å²é…ç½®çš„ç¼“å­˜
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  &lt;span style=&#34;color:#a6e22e&#34;&gt;data&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;Storage&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;// pebble çš„å°è£…ï¼Œç”¨äºåº”ç”¨æ•°æ®ä¿®æ”¹å’ŒæŒä¹…åŒ–
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  &lt;span style=&#34;color:#a6e22e&#34;&gt;cache&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;map&lt;/span&gt;[&lt;span style=&#34;color:#66d9ef&#34;&gt;int64&lt;/span&gt;]&lt;span style=&#34;color:#66d9ef&#34;&gt;string&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;// è¯·æ±‚ç¼“å­˜ï¼Œé˜²æ­¢è¯·æ±‚é‡å¤
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;34-æ•°æ®åˆ†ç‰‡&#34;&gt;3.4 æ•°æ®åˆ†ç‰‡&lt;/h4&gt;
&lt;p&gt;æœ¬ç³»ç»Ÿé€‰æ‹©äº†ä½¿ç”¨é€šè¿‡é”®çš„æ•£åˆ—åˆ†ç‰‡çš„æ–¹å¼ï¼Œè¿™æ ·çš„è®¾è®¡å¯ä»¥å‡å°‘æ•°æ®åæ–œï¼Œé˜²æ­¢å°‘éƒ¨åˆ†åˆ†ç‰‡å˜æˆçƒ­ç‚¹ã€‚è€ƒè™‘åˆ°é€šè¿‡é”®çš„èŒƒå›´åˆ†åŒºçš„æ–¹å¼åœ¨äº§ç”Ÿæ•°æ®åæ–œçš„æƒ…å†µä¸‹éœ€è¦é‡æ–°åˆ†è£‚åˆ†ç‰‡ï¼Œå®ç°æ›´ä¸ºå¤æ‚ï¼Œä¸ºäº†ç®€å•èµ·è§ï¼Œæˆ‘ä»¬é€šè¿‡æ•£åˆ—é”®æ¥åˆ†ç‰‡çš„æ–¹å¼å‡å°‘æ•°æ®å€¾æ–œã€‚&lt;/p&gt;
&lt;p&gt;æ•°æ®åº“è·å–æ•°æ®åˆ†ç‰‡çš„æ–¹å¼æ˜¯å®¢æˆ·ç«¯æ ¹æ® shard å‡½æ•°è®¡ç®—å‡ºè‡ªå·±æ‰€å¤„çš„åˆ†ç‰‡å·ï¼Œç„¶åé€šè¿‡ master è·å– shard æ‰€å¤„çš„ Raft Group çš„ä¿¡æ¯ã€‚é€šè¿‡ Raft Group åˆ°å…·ä½“ kv æœåŠ¡å™¨ç»„çš„æ˜ å°„æ¥è·å– shard æ‰€å¤„çš„ kv æœåŠ¡å™¨ã€‚è€ƒè™‘æ¯ç»„åˆ° kv æœåŠ¡å™¨æ•°é‡é€šå¸¸ä¸ä¼šè¶…è¿‡ 5 ä¸ªï¼Œæ‰€ä»¥æˆ‘ä»¬é‡‡ç”¨ç›´æ¥è½®æ¬¡è®¿é—®çš„æ–¹å¼æ¥å°è¯•æ‰¾åˆ°å®é™…çš„ Raft Group çš„ Leader èŠ‚ç‚¹ï¼Œå¯ä»¥é€šè¿‡ç¼“å­˜ Leader èŠ‚ç‚¹æ¥è·å¾—å‡æ‘ŠæŸ¥è¯¢æ¬¡æ•°ä¸ºä¸€æ¬¡çš„ä¼˜åŒ–ã€‚&lt;/p&gt;
&lt;p&gt;é…ç½®å’Œ meta æœåŠ¡å™¨çš„ç»“æ„ä½“ä¼ªä»£ç å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Config&lt;/span&gt; {
  &lt;span style=&#34;color:#a6e22e&#34;&gt;Num&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;// é…ç½® Id
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  &lt;span style=&#34;color:#a6e22e&#34;&gt;Shards&lt;/span&gt; [&lt;span style=&#34;color:#a6e22e&#34;&gt;NShards&lt;/span&gt;]&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;// HashMap&amp;lt;åˆ†ç‰‡å·, Raft Group å·&amp;gt;ï¼Œå› ä¸ºä¸€ä¸ªåˆ†ç‰‡åªå±äºä¸€ä¸ª Raft Groupï¼Œæ‰€ä»¥ç”¨æ•°ç»„ç›´æ¥å­˜å‚¨ã€‚Shards[0]ä»£è¡¨ Id ä¸º 0 çš„åˆ†ç‰‡çš„ Raft Group å·
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  &lt;span style=&#34;color:#a6e22e&#34;&gt;Groups&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;map&lt;/span&gt;&amp;lt;&lt;span style=&#34;color:#a6e22e&#34;&gt;Raft&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Group&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Id&lt;/span&gt;, []&lt;span style=&#34;color:#a6e22e&#34;&gt;KVServer&lt;/span&gt;&amp;gt; &lt;span style=&#34;color:#75715e&#34;&gt;// HashMap&amp;lt;Raft Group å·, kv æœåŠ¡å™¨ç»„&amp;gt;
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;MetaServer&lt;/span&gt; {
  &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt; &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;\&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;raft&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Raft&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;// ä½¿ç”¨ Raft ç»´æŒå‰¯æœ¬
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  &lt;span style=&#34;color:#a6e22e&#34;&gt;configs&lt;/span&gt; []&lt;span style=&#34;color:#a6e22e&#34;&gt;Config&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;// å­˜å‚¨çš„é…ç½®åºåˆ—
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  &lt;span style=&#34;color:#a6e22e&#34;&gt;cache&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;map&lt;/span&gt;&amp;lt;&lt;span style=&#34;color:#a6e22e&#34;&gt;RequestId&lt;/span&gt;, &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;&amp;gt; &lt;span style=&#34;color:#75715e&#34;&gt;// è¯·æ±‚ç¼“å­˜ï¼Œæ¯ä¸ªè¯·æ±‚ä¸€ä¸ª Idï¼Œé˜²æ­¢é‡å¤å†™å…¥
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é€šè¿‡æŠŠåˆ†ç‰‡å°½å¯èƒ½å¹³å‡åˆ†é…åœ¨ Raft Group ä¸­æ¥å¹³è¡¡æ•°æ®çš„åœ¨èŠ‚ç‚¹ä¸­çš„å­˜å‚¨ã€‚&lt;/p&gt;
&lt;h4 id=&#34;35-çŠ¶æ€åŒæ­¥å’ŒæŒä¹…åŒ–è¿‡ç¨‹&#34;&gt;3.5 çŠ¶æ€åŒæ­¥å’ŒæŒä¹…åŒ–è¿‡ç¨‹&lt;/h4&gt;
&lt;p&gt;æ•°æ®åŒæ­¥æœåŠ¡é€šè¿‡åœ¨å¤šä¸ªå¤åˆ¶æœåŠ¡å™¨ä¸Šå­˜å‚¨å…¶çŠ¶æ€çš„å®Œæ•´å‰¯æœ¬æ¥å®ç°å®¹é”™æ€§ã€‚å¤åˆ¶å…è®¸æœåŠ¡ç»§ç»­è¿è¡Œï¼Œå³ä½¿å…¶æŸäº›æœåŠ¡å™¨é‡åˆ°æ•…éšœï¼ˆå´©æºƒæˆ–ç½‘ç»œä¸­æ–­ï¼‰ã€‚æŒ‘æˆ˜åœ¨äºï¼Œæ•…éšœå¯èƒ½å¯¼è‡´å‰¯æœ¬ä¿å­˜ä¸åŒçš„æ•°æ®å‰¯æœ¬ã€‚&lt;/p&gt;
&lt;p&gt;éœ€è¦åŒæ­¥çŠ¶æ€çš„æœ‰ä¸¤ä¸ªåœ°æ–¹ï¼Œä¸€ä¸ªæ˜¯ meta æœåŠ¡å™¨çš„é…ç½®åŒæ­¥ï¼Œé…ç½®æ˜¯ä¸€ä¸ªç®€å•çš„ç»“æ„ä½“ï¼Œå› ä¸ºæ•°æ®é‡åªæœ‰ä¸åˆ° 1KBï¼Œæ‰€ä»¥ç›´æ¥é€šè¿‡ json åºåˆ—åŒ–ä¿å­˜åˆ°æ–‡ä»¶æŒä¹…åŒ–ï¼Œç¬¬äºŒä¸ªæ˜¯ shard ä¸­ kv æ•°æ®æ“ä½œçš„å¤åˆ¶ï¼Œæˆ‘ä»¬çš„æ¯æ¬¡æ“ä½œä¼šå†™å…¥æ—¥å¿—ï¼Œå¯ä»¥æŠŠå®ƒå½“åš mysql çš„ binlogï¼Œæˆ‘ä»¬ä¾é å¤åˆ¶æ“ä½œæ—¥å¿—æ¥å®ç° kv æœåŠ¡å™¨çš„æ•°æ®åŒæ­¥ã€‚æˆ‘ä»¬æŠŠå°è£…çš„ pebble å­˜å‚¨å¼•æ“å½“åš Raft Group é‡Œçš„çŠ¶æ€æœºï¼Œå½“èŠ‚ç‚¹å¯ä»¥æäº¤æ—¶ï¼Œä¼šå†™å…¥æ•°æ®åˆ° pebble å¼•æ“æŒä¹…åŒ–æ•°æ®ã€‚&lt;/p&gt;
&lt;p&gt;Raft ç»“æ„ä½“ä¼ªä»£ç å¦‚ä¸‹ï¼š
(çœç•¥äº†é”ï¼ŒæœåŠ¡å™¨ä¼˜é›…å…³é—­ï¼Œå…¶ä»–æœåŠ¡å™¨åˆ—è¡¨ç­‰å¯¹ Raft ç®—æ³•æœ¬èº«æ— æ„ä¹‰çš„å­—æ®µä»¥å¢åŠ å¯è¯»æ€§)&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Raft&lt;/span&gt; {
  &lt;span style=&#34;color:#a6e22e&#34;&gt;persister&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;Persister&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;// æŒä¹…åŒ–ç»“æ„ä½“
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  &lt;span style=&#34;color:#a6e22e&#34;&gt;leaderId&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;// LeaerIdï¼Œå¦‚æœè‡ªå·±æ˜¯ Leader,é‚£ä¹ˆ id å°±æ˜¯è‡ªå·±çš„ id
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  &lt;span style=&#34;color:#a6e22e&#34;&gt;currentTerm&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;// å½“å‰ä»»æœŸå·
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  &lt;span style=&#34;color:#a6e22e&#34;&gt;votedFor&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;// å½“å‰ä»»æœŸæŠ•ç¥¨ç»™è°ï¼Œå¯¹äº candidateï¼Œä¼šæŠ•ç¥¨ç»™è‡ªå·±
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  &lt;span style=&#34;color:#a6e22e&#34;&gt;commitIndex&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;// æäº¤å·ï¼Œå¤åˆ¶åˆ°å¤§éƒ¨åˆ†èŠ‚ç‚¹å°±å¯ä»¥æäº¤
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  &lt;span style=&#34;color:#a6e22e&#34;&gt;lastApplied&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;// åº”ç”¨å·ï¼Œæäº¤å·æ›´æ–°åˆ™ä¼šç«‹åˆ»åº”ç”¨åˆ°çŠ¶æ€æœº
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  &lt;span style=&#34;color:#a6e22e&#34;&gt;logIndex&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;// æœ€åçš„æ—¥å¿—å·
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  &lt;span style=&#34;color:#a6e22e&#34;&gt;log&lt;/span&gt; []&lt;span style=&#34;color:#a6e22e&#34;&gt;Entry&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;// æ—¥å¿—åºåˆ—
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  &lt;span style=&#34;color:#a6e22e&#34;&gt;nextIndex&lt;/span&gt; []&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;// ä½œä¸º Leader æ—¶ï¼Œç»´æŠ¤çš„å…¶ä»–èŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªæ—¥å¿—å·
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  &lt;span style=&#34;color:#a6e22e&#34;&gt;matchIndex&lt;/span&gt; []&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;// ä½œä¸º Leader æ—¶ï¼Œç»´æŠ¤çš„å…¶ä»–èŠ‚ç‚¹çš„åŒ¹é…çš„æ—¥å¿—å·
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  &lt;span style=&#34;color:#a6e22e&#34;&gt;electionTimer&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;Timer&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;// é€‰ä¸¾è®¡æ—¶å™¨
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  &lt;span style=&#34;color:#a6e22e&#34;&gt;heartbeatTimer&lt;/span&gt; &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;\&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;Timer&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;// ä½œä¸º Leader æ—¶ï¼Œå¿ƒè·³è®¡æ—¶å™¨
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é€šè¿‡å®ç° raft è®ºæ–‡ä¸­æè¿°çš„ç³»ç»Ÿï¼Œå®ç°äº† Raft:VoteRequest, Raft:AppendEntry å’Œ Raft:InstallSanpshot ä¸‰ä¸ªä¸»è¦ RPCï¼Œå…¶ä¸­ AppendEntry åŒæ—¶ç”¨äºæ—¥å¿—å¹¿æ’­å’Œç»´æŒå¿ƒè·³é˜»æ­¢ follower å‘èµ·æŠ•ç¥¨ã€‚&lt;/p&gt;
&lt;h4 id=&#34;36-å®¢æˆ·ç«¯&#34;&gt;3.6 å®¢æˆ·ç«¯&lt;/h4&gt;
&lt;p&gt;å®¢æˆ·ç«¯ä¼šé€šè¿‡ shard(key)å‡½æ•°è·å–é”®æ‰€å¤„çš„åˆ†ç‰‡ï¼Œè¿™æ˜¯ä¸€ä¸ªç®€å•çš„å“ˆå¸Œå‡½æ•°ï¼Œç„¶åé€šè¿‡ç¼“å­˜è‡ª meta æœåŠ¡å™¨çš„é…ç½®ä¿¡æ¯æ‰¾å‡ºé”®æ‰€å¤„çš„ kv æœåŠ¡å™¨ï¼Œæœ€åç›´æ¥å’Œ kv æœåŠ¡å™¨é€šä¿¡ï¼Œå¯»æ‰¾ Leaderï¼Œé€šè¿‡ Leader æäº¤è¯·æ±‚éœ€è¦çš„æ“ä½œã€‚åœ¨ä¸€è‡´æ€§è¦æ±‚ä¸é«˜çš„è¯·æ±‚ä¸­ï¼Œè¯»æ“ä½œå¯ä»¥è®¿é—®ä»»æ„ä¸€ä¸ªæœåŠ¡å™¨ï¼Œè€Œå†™æ“ä½œåªèƒ½å†™å…¥ Leaderï¼Œä½†æ˜¯æœ¬ç³»ç»Ÿéƒ½ä¼šä» Leader è¯»å–ä»¥ä¿è¯çº¿ä¸‹ä¸€è‡´æ€§ã€‚å®¢æˆ·ç«¯çš„é…ç½®ä¿¡æ¯æ˜¯åˆå§‹åŒ–çš„æ—¶å€™è·å–çš„ï¼Œå¦‚æœæŸä¸ªè¯·æ±‚è¯»å–å®Œæ‰€æœ‰çš„ kv æœåŠ¡å™¨ä»ç„¶æ²¡æœ‰å‘ç° leaderï¼Œå®¢æˆ·ç«¯åˆ™ä¼šé‡æ–°ä» meta æœåŠ¡å™¨ä¸­è·å–é…ç½®ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;h4 id=&#34;37-è°ƒç”¨è¿‡ç¨‹&#34;&gt;3.7 è°ƒç”¨è¿‡ç¨‹&lt;/h4&gt;
&lt;h4 id=&#34;371-å¤–éƒ¨è¯·æ±‚ä¸»è¦è¿‡ç¨‹&#34;&gt;3.7.1 å¤–éƒ¨è¯·æ±‚ä¸»è¦è¿‡ç¨‹ï¼š&lt;/h4&gt;
&lt;p&gt;å®¢æˆ·ç«¯æ“ä½œï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;é¦–å…ˆæ ¹æ®é”®è®¡ç®—å‡ºæ‰€å¤„åˆ†ç‰‡&lt;/li&gt;
&lt;li&gt;ç”Ÿæˆ RequestId æ¥é˜²æ­¢é‡å¤è¯·æ±‚&lt;/li&gt;
&lt;li&gt;ä»ç¼“å­˜çš„é…ç½®ä¸­æ‰¾åˆ° shard æ‰€å± Raft Groupï¼Œå¹¶æ‰¾åˆ° kv æœåŠ¡å™¨åˆ—è¡¨&lt;/li&gt;
&lt;li&gt;ä¾æ¬¡è¯·æ±‚ kv æœåŠ¡å™¨åˆ—è¡¨ï¼Œå°è¯•è·å–å€¼
kv æœåŠ¡å™¨(Leader)æ“ä½œï¼š&lt;/li&gt;
&lt;li&gt;å¦‚æœä¸æ˜¯ Leaderï¼Œç›´æ¥æ‹’ç»(å¯ä»¥é€šè¿‡ä»£ç†è¯·æ±‚æˆ–è€…è¿”å› LeaderId æ¥ä¼˜åŒ–)&lt;/li&gt;
&lt;li&gt;å¯¹æ¯” RequestId æ˜¯å¦é‡å¤ï¼Œå¦‚æœå·²ç»è¯·æ±‚è¿‡äº†ï¼Œé˜»æ­¢é‡å¤å†™å…¥&lt;/li&gt;
&lt;li&gt;æ ¹æ®è‡ªå·±çš„é…ç½®æ£€æŸ¥è‡ªå·±æ˜¯å¦æ‹¥æœ‰è¯¥ key çš„ shard&lt;/li&gt;
&lt;li&gt;å†™å…¥ä¸€ä¸ª raft æ—¥å¿—åˆ°æ—¥å¿—åºåˆ—(å¯¹äºè¯»è¯·æ±‚éœ€è¦å†™å…¥ä¸€ä¸ªç©ºæ—¥å¿—ç”¨äºè§£å†³è„‘è£‚é™ˆæ—§æ•°æ®é—®é¢˜ï¼Œä¸‹æ–‡ä¼šä»‹ç»å¯èƒ½çš„ä¼˜åŒ–æ–¹æ³•)&lt;/li&gt;
&lt;li&gt;å¹¿æ’­æ—¥å¿—ç»™ follower èŠ‚ç‚¹ï¼Œæºå¸¦ä¹‹å‰çš„æ—¥å¿—å·å’Œæ—¥å¿—ä»»æœŸå·&lt;/li&gt;
&lt;li&gt;å¾—åˆ°å¤§å¤šæ•°èŠ‚ç‚¹çš„å†™å…¥å›å¤åˆ™ä¼šæäº¤&lt;/li&gt;
&lt;li&gt;ä» pebble ä¸­è·å–è¯¥é”®ï¼Œå¯¹äºå†™å…¥æ“ä½œï¼Œè¿™é‡Œéœ€è¦æäº¤åº”ç”¨å·ï¼Œä½†æ˜¯è¯»å–æ“ä½œåœ¨æäº¤åå¯ä»¥ç›´æ¥è¿”å›å€¼æ•°æ®
3.7.2 æ–°å¢æˆ–ç§»é™¤ Raft Group çš„ä¸»è¦è¿‡ç¨‹ï¼š
(æŸ¥è¯¢é…ç½®çš„è¯·æ±‚åŸºæœ¬ç›¸åŒ)&lt;/li&gt;
&lt;li&gt;è¯·æ±‚ meta æœåŠ¡å™¨&lt;/li&gt;
&lt;li&gt;å¯¹æ¯” RequestId æ˜¯å¦é‡å¤ï¼Œå¦‚æœå·²ç»è¯·æ±‚è¿‡äº†ï¼Œé˜»æ­¢é‡å¤å†™å…¥&lt;/li&gt;
&lt;li&gt;è°ƒåº¦ shardï¼Œä»¥ä¾¿äº shard å¹³å‡åˆ†é…åœ¨ Raft Group ä¸­ï¼Œä¿å­˜ä¸ºæ–°çš„é…ç½®&lt;/li&gt;
&lt;li&gt;å°†æ–°çš„é…ç½®å†™å…¥ raft çš„é…ç½®æ—¥å¿—åºåˆ—&lt;/li&gt;
&lt;li&gt;å¹¿æ’­æ—¥å¿—ç»™ follower èŠ‚ç‚¹ï¼Œæºå¸¦ä¹‹å‰çš„æ—¥å¿—å·å’Œæ—¥å¿—ä»»æœŸå·&lt;/li&gt;
&lt;li&gt;å¾—åˆ°å¤§å¤šæ•° meta èŠ‚ç‚¹çš„å†™å…¥å›å¤åˆ™ä¼šæäº¤&lt;/li&gt;
&lt;li&gt;æ›´æ–° MetaServer çš„ config å­—æ®µï¼Œæ ‡æ³¨ä¸ºå½“å‰æœ€æ–°çš„é…ç½®
3.7.3 kv æœåŠ¡å™¨å‡è¡¡ shard çš„è¿‡ç¨‹ï¼š&lt;/li&gt;
&lt;li&gt;å®šæ—¶è½®è®­ MetaServer çš„é…ç½®ä¿¡æ¯ï¼Œå¦‚æœæœ‰æ–°çš„é…ç½®ä¿¡æ¯ï¼Œåˆ™æ›´æ–°æœ¬åœ°çš„é…ç½®&lt;/li&gt;
&lt;li&gt;å¦‚æœå‘ç°é…ç½®å˜åŠ¨ï¼Œdiff è‡ªèº«æ‹¥æœ‰çš„ shard å’Œæ–°é…ç½®é‡Œæè¿°çš„ shard&lt;/li&gt;
&lt;li&gt;å¦‚æœ shard ä¸ä¸€è‡´ï¼Œå°†æ–°çš„ shard æ”¾åˆ°è¯·æ±‚é˜Ÿåˆ—&lt;/li&gt;
&lt;li&gt;ä»å…¶ä»– kv æœåŠ¡å™¨(ç»„ Leader)æ‹‰å–éœ€è¦çš„ shardï¼Œé€šè¿‡éå† pebble è¯¥ shard é‡Œçš„ kv å¹¶åºåˆ—åŒ–å¯¹æ¥æ‰“åŒ… shard ä¼ é€(ä¸€ç§å¯èƒ½çš„ä¼˜åŒ–æ–¹æ³•æ˜¯ç›´æ¥ä¼ é€ sstable)&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;4-æ€»ç»“&#34;&gt;4 æ€»ç»“&lt;/h3&gt;
&lt;h4 id=&#34;41-å­¦åˆ°çš„ç»éªŒ&#34;&gt;4.1 å­¦åˆ°çš„ç»éªŒ&lt;/h4&gt;
&lt;p&gt;å¯¹äº master/slave ç»“æ„çš„ç³»ç»Ÿï¼Œå¦‚æœæˆ‘ä»¬çš„ master æœ‰å¾ˆå¤šè¯·æ±‚æˆ–è€…å†™å…¥æ“ä½œï¼Œé‚£ä¹ˆä»–å¾ˆæœ‰å¯èƒ½å˜æˆç“¶é¢ˆï¼Œä½†æ˜¯æˆ‘ä»¬ä¾ç„¶å¯ä»¥é€šè¿‡å…¶ä»–èŠ‚ç‚¹å¤„ç†å¤–éƒ¨è¯·æ±‚çš„æ–¹å¼å®ç°æ¥è¿‘äºçº¿æ€§çš„ä¼¸ç¼©æ€§ã€‚&lt;/p&gt;
&lt;p&gt;æ•£åˆ—åˆ†ç‰‡çš„æ–¹å¼è™½ç„¶æ›´å®¹æ˜“å®ç°æ•°æ®è´Ÿè½½å‡è¡¡åˆ†é…ï¼Œä½†æ˜¯ä¹Ÿå¯èƒ½ç»™èŒƒå›´æŸ¥è¯¢å¸¦æ¥é—®é¢˜ï¼Œéœ€è¦è·¨å¤šä¸ªåˆ†ç‰‡åˆå¹¶æŸ¥è¯¢ï¼Œé™ä½äº†ç³»ç»Ÿæ€§èƒ½ã€‚&lt;/p&gt;
&lt;p&gt;è¿™äº›é—®é¢˜åœ¨ç³»ç»Ÿè®¾è®¡çš„è¿‡ç¨‹ä¸­å¤šæ¬¡é‡åˆ°ï¼Œä¹Ÿå› æ­¤åšäº†å¾ˆå¤šæƒè¡¡ï¼Œå¯èƒ½å¾ˆå¤šæ—¶å€™ä¸æ˜¯æœ€ä½³çš„å®ç°ã€‚&lt;/p&gt;
&lt;h4 id=&#34;42-å…¶ä»–å·¥ä½œå’Œå¯ä»¥ä¼˜åŒ–çš„åœ°æ–¹&#34;&gt;4.2 å…¶ä»–å·¥ä½œå’Œå¯ä»¥ä¼˜åŒ–çš„åœ°æ–¹&lt;/h4&gt;
&lt;p&gt;è¯¥ç³»ç»Ÿçš„æ€»ä½“æ¶æ„å¼€å§‹ä¸»è¦å‚è€ƒäº† BigTable è®ºæ–‡å®ç°ï¼Œä½†æ˜¯å®ç°ä¸Šä¸ BigTable æœ‰å¾ˆå¤šæ–¹é¢çš„åŒºåˆ«ï¼Œç¬¬ä¸€ï¼Œè¯¥ç³»ç»Ÿæ²¡æœ‰é‡‡ç”¨ chubby(å¼€æºå®ç°å¯¹åº”ä¸º zookeeper)å»å­˜å‚¨å…³é”®å…ƒæ•°æ®ï¼Œè€Œæ˜¯é‡‡ç”¨ Raft ç®—æ³•å®ç°å¤šä¸ªå‰¯æœ¬ä»£æ›¿ï¼Œ&lt;/p&gt;
&lt;p&gt;ç¬¬äºŒï¼ŒTablet Server ä¸­çš„ Tablet å®é™…ä¸Šæ˜¯ä¿å­˜åœ¨ GFS ä¸Šçš„ chunkï¼Œä¾é  GFS æé«˜å¯ç”¨æ€§ï¼Œä½†æ˜¯ä¹ŸæŸå¤±äº†ä¸€å®šçš„æ€§èƒ½ï¼Œè€Œæˆ‘ä»¬é€šè¿‡ Raft Group çš„æ–¹å¼å®ç° shard çš„å¤šå‰¯æœ¬æœºåˆ¶æé«˜å¯ç”¨æ€§ã€‚&lt;/p&gt;
&lt;p&gt;ç¬¬ä¸‰ï¼ŒBigTable ä¸­æ•°æ®å­˜å‚¨äº sst ä¸­ï¼Œsst æ˜¯ä¸€ä¸ªæ’åºè¡¨ï¼Œå¯¹åº”çš„å¼€æºå®ç°æ˜¯ LSM ç»“æ„çš„ leveldbï¼Œleveldb é€‚ç”¨äºå¤šå†™å°‘è¯»çš„åœºæ™¯ï¼Œä½†æ˜¯å†™æ”¾å¤§é—®é¢˜é¥±å—è¯Ÿç—…ï¼Œpebble å¯ä»¥çœ‹åšæ˜¯ä¸€ä¸ª go ç‰ˆæœ¬çš„ leveldbï¼Œä¹Ÿæ˜¯ CockroachDB çš„å­˜å‚¨å¼•æ“ï¼Œå®ƒä¼˜åŒ–äº† leveldb çš„ä¸€äº›é—®é¢˜ï¼Œè€ƒè™‘åˆ°å­˜å‚¨å¼•æ“å®ç°çš„å¤æ‚ç¨‹åº¦è¾ƒé«˜ï¼Œç¬”è€…ç›´æ¥ä½¿ç”¨äº†è¯¥å­˜å‚¨å¼•æ“æ¥æŒä¹…åŒ–æ•°æ®ã€‚&lt;/p&gt;
&lt;p&gt;æœ€åï¼Œè€ƒè™‘åˆ°å·¥ä½œé‡ä¹Ÿå¹¶æ²¡æœ‰èƒ½å®ç° BigTable é‡Œæè¿°çš„å¤šç‰ˆæœ¬çš„æ•°æ®å­˜å‚¨ï¼Œå› æ­¤æ•°æ®æ¨¡å‹åªæœ‰ä¸¤ä¸ªç»´åº¦ï¼Œä¹Ÿä¸éœ€è¦è€ƒè™‘ç‰ˆæœ¬çš„åƒåœ¾å›æ”¶ã€‚&lt;/p&gt;
&lt;p&gt;è¯¥æ•°æ®åº“å°šæœ‰å¾ˆå¤šå¯ä»¥ä¼˜åŒ–çš„åœ°æ–¹ï¼Œå¯¹äºå®¢æˆ·ç«¯æŸ¥è¯¢ï¼Œå¯ä»¥å°è¯•ç¼“å­˜ Leader ä¿¡æ¯ï¼Œå®¢æˆ·ç«¯æ¯æ¬¡æŸ¥è¯¢ç‰¹å®š Raft Group çš„æ—¶å€™ï¼Œé€šè¿‡è½®æ¬¡æŸ¥è¯¢è·å¾—ç‰¹å®šçš„ Group çš„ Leader èŠ‚ç‚¹ä¿¡æ¯ï¼Œæ­¤æ—¶ç¼“å­˜ Leader èŠ‚ç‚¹ä¿¡æ¯ï¼Œå› ä¸º Leader ä¸€èˆ¬ä¸ä¼šä¸æ–­æ›´æ–°ï¼Œæ‰€ä»¥å¯ä»¥æ¯æ¬¡å®¢æˆ·ç«¯æŸ¥è¯¢çš„å‡æ‘Šæ¬¡æ•°å¯ä»¥æ¥è¿‘ä¸€æ¬¡ã€‚&lt;/p&gt;
&lt;p&gt;æ ¹æ® Raft ç®—æ³•è®ºæ–‡å®¢æˆ·ç«¯éƒ¨åˆ†çš„æè¿°ï¼Œå¯ä»¥å®ç°åŸºäºç§Ÿçº¦çš„æ–¹å¼æ¥é˜»æ­¢è„‘è£‚ä¸‹çš„é™ˆæ—§æ•°æ®é—®é¢˜ï¼Œè¿™æ ·å¯ä»¥æé«˜æ•´ä½“çš„æ€§èƒ½ï¼Œç›®å‰çš„åšæ³•æ˜¯å°†è¯»ç±»å‹çš„è¯·æ±‚å†™å…¥ log é€šè¿‡ Raft æäº¤ï¼Œæäº¤ä¹‹åä¸€å®šèƒ½è·å–æœ€æ–°çš„æ•°æ®ï¼Œè¿™æ ·æ¯æ¬¡è¯»èµ·ç éœ€è¦è·å–è¿‡åŠèŠ‚ç‚¹ä¸­æœ€æ…¢èŠ‚ç‚¹çš„ä¸€æ¬¡è¯·æ±‚å“åº”å»¶è¿Ÿã€‚è¿™æ ·çš„è§£å†³æ–¹æ³•è™½ç„¶å¯ä»¥å®ç°çº¿æ€§ä¸€è‡´æ€§ï¼Œä½†æ˜¯æ€§èƒ½ä¸ä½³ã€‚ä¸€ç§å¯èƒ½çš„æ›´ç®€å•çš„ä¼˜åŒ–æ–¹æ³•æ˜¯å¹¿æ’­ä¸€ä¸ªç©º RPC æ¥ç¡®è®¤è‡ªå·±ä»ç„¶æ˜¯ Leaderï¼Œè¿™æ ·å¯ä»¥é¿å…æäº¤å’Œå­˜å‚¨åˆ°æ—¥å¿—è¿™äº›ä¸å¿…è¦çš„æ“ä½œã€‚&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨åŸºäºèŒƒå›´çš„åˆ†ç‰‡å¯ä»¥å®ç°é«˜æ•ˆçš„èŒƒå›´æŸ¥è¯¢ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥åœ¨åˆ†ç‰‡è¿‡å¤§çš„æ—¶å€™åŠ¨æ€çš„åˆ†è£‚åˆ†ç‰‡ï¼Œæœ¬ç³»ç»Ÿé‡Œåªæ˜¯ç®€å•çš„é…ç½®å›ºå®šæ•°é‡çš„åˆ†ç‰‡ï¼Œå¦‚æœæŒ‰ç…§é”®èŒƒå›´åˆ†ç‰‡åˆ™éœ€è¦åŠ¨æ€åˆ†å‰²åˆ†ç‰‡ã€‚ç„¶åä¾é å·²ç»å®ç°çš„ meta æœåŠ¡å™¨è°ƒåº¦ï¼Œå°†æ–°åˆ†ç‰‡è½¬ç§»åˆ°å…¶ä»– Raft Groupã€‚&lt;/p&gt;
&lt;p&gt;æœ€åå¯ä»¥å®ç°ä¸€äº›ç®€å•çš„ç›‘æ§ç³»ç»Ÿï¼Œä»¥æ”¶é›†åˆ†ç‰‡ï¼Œæ¯ç§’æ¥å—çš„ RPC æ•°é‡ï¼ŒLeader è½¬ç§»çš„æ¬¡æ•°ç­‰ä¿¡æ¯ï¼Œä¾¿äºæ›´å¥½çš„äº†è§£ç³»ç»Ÿè¿è¡ŒçŠ¶æ€ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å‚è€ƒæ–‡çŒ®&#34;&gt;å‚è€ƒæ–‡çŒ®&lt;/h2&gt;
&lt;p&gt;(å¿½ç•¥äº†ä¸€äº›æ¯«æ— ä»·å€¼ï¼Œå—æŸäº›å› ç´ å½±å“æ”¾ä¸Šå»çš„è®ºæ–‡ :)&lt;/p&gt;
&lt;p&gt;[1] Fay Chang, Jeffrey Dean, Sanjay Ghemawat, Wilson C. Hsieh, Deborah A. Wallach, Michael Burrows, Tushar Chandra, Andrew Fikes, Robert Gruber: Bigtable: A Distributed Storage System for Structured Data[J]. OSDI 2006:205-218.&lt;br&gt;
[2] Diego Ongaro and John Ousterhout Stanford University. In Search of an Understandable Consensus Algorithm (Extended Version)[J]. 2013ï¼&lt;br&gt;
[3] é™ˆé™†. åˆ†å¸ƒå¼é”®å€¼å­˜å‚¨å¼•æ“çš„ç ”ç©¶ä¸å®ç°[D]. æ±Ÿè‹ç§‘æŠ€å¤§å­¦ï¼Œ2016.&lt;br&gt;
[4] èµµæ±Ÿ. åŸºäº LevelDB çš„åˆ†å¸ƒå¼æ•°æ®åº“çš„ç ”ç©¶ä¸å®ç°[D].å›½é˜²ç§‘å­¦æŠ€æœ¯å¤§å­¦ï¼Œ2019.&lt;br&gt;
[5] .&lt;br&gt;
[6] .&lt;br&gt;
[7] Sanjay Ghemawat, Howard Gobioff, and Shun-Tak Leung Google. The Google File System[J]. 2003.&lt;br&gt;
[8] VoltDB. VoltDB Resources[OL].2012.&lt;br&gt;
[9] Patrick Hunt and Mahadev Konar Yahoo! Grid, Flavio P. Junqueira and Benjamin Reed Yahoo! Research. ZooKeeper: Wait-free coordination for Internet-scale systems[J]. 2005.&lt;br&gt;
[10] .&lt;br&gt;
[11] .&lt;br&gt;
[12] æ¶‚è…¾é£. Go è¯­è¨€ä¸­çš„å¹¶å‘é—®é¢˜ç ”ç©¶[D].åŒ—äº¬é‚®ç”µå¤§å­¦ï¼Œ2019.&lt;br&gt;
[13] .&lt;/p&gt;
</content>
    </item>
    
  </channel>
</rss>
